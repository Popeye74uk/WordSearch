<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robust Word Search Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #333; background-color: #f8f9fa; padding: 20px; margin: 0; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; }
        .container { width: 100%; max-width: 900px; margin: 0 auto; }
        h1, h2.theme-title { text-align: center; color: #343a40; }
        h2.theme-title { margin-top: 5px; margin-bottom: 0; font-size: 1.2em; font-weight: normal; }
        p#theme-definition { text-align: center; font-style: italic; color: #6c757d; margin-top: 4px; min-height: 1.2em; max-width: 580px; margin-left: auto; margin-right: auto; }
        #puzzle-container { display: flex; margin-top: 20px; justify-content: center; }
        #grid-wrapper { position: relative; }
        #grid { display: grid; gap: 1px; background-color: #adb5bd; border: 1px solid #adb5bd; font-family: "Courier New", Courier, monospace; font-weight: bold; }
        #grid div { width: 28px; height: 28px; text-align: center; line-height: 28px; background-color: #fff; text-transform: uppercase; user-select: none; }
        #grid div.revealed { background-color: #ffc107; color: #000; }
        .loader { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: #f8f9fa; display: flex; justify-content: center; align-items: center; flex-direction: column; gap: 15px; z-index: 10; font-size: 1.1em; color: #495057; border-radius: 4px; }
        .loader.hidden { opacity: 0; pointer-events: none; }
        #loader-time { font-size: 0.9em; font-style: italic; color: #6c757d; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #word-list-container { width: fit-content; margin: 20px auto 0 auto; }
        #word-list-container h3 { text-align: center; margin-top: 0; color: #495057; }
        #words { list-style-type: none; padding: 0; margin: 0; display: grid; grid-auto-flow: column; gap: 0 40px; }
        #words li { padding: 4px 0; text-transform: uppercase; font-size: 0.95em; color: #495057; text-align: left; }
        .controls-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 415px; margin: 25px auto 0 auto; }
        .single-button-container { max-width: 415px; margin: 15px auto 0 auto; }
        button { padding: 12px 20px; font-size: 1em; font-weight: bold; cursor: pointer; color: white; border: none; border-radius: 5px; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); width: 100%; box-sizing: border-box; }
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        button:disabled { background-color: #6c757d; cursor: not-allowed; opacity: 0.7; }
        #generate-btn { background-color: #007bff; }
        #reveal-btn { background-color: #28a745; }
        #download-pdf-btn { background-color: #6f42c1; }
        #custom-puzzle-btn { background-color: #17a2b8; }
        #make-book-btn { background-color: #fd7e14; }
        #create-book-btn { background-color: #dc3545; }
        #generate-custom-btn { background-color: #007bff; }
        #cancel-btn, #cancel-book-options-btn, #cancel-custom-btn { background-color: #6c757d; }
        #advanced-options-panel, #generate-book-controls { display: none; }
        .options-panel-grid { display: grid; grid-template-columns: auto 1fr; justify-content: center; align-items: center; gap: 10px 15px; max-width: 415px; margin: 15px auto 0 auto; }
        .options-panel-grid label { text-align: right; }
        .options-panel-grid .full-width { grid-column: 1 / -1; }
        #status-container { text-align: center; margin-top: 15px; font-style: italic; min-height: 20px; color: #6c757d; }
        #version-info { text-align: center; margin-top: 20px; font-size: 0.8em; color: #adb5bd; }
        @media print { @page { size: A4; margin: 0.5in; } body { background-color: #fff; font-size: 12pt; margin: 0; padding: 0; } .container { width: 100%; margin: 0; padding: 0; box-shadow: none; } h1, .controls-grid, .single-button-container, #advanced-options-panel, #generate-book-controls, #status-container, #version-info { display: none; } #grid-wrapper { border: 2px solid #333; border-radius: 10px; padding: 10px; } #grid { border: none; } #word-list-container { margin-top: 15px; } }
    </style>
</head>
<body>

    <div class="container">
        <h1>Word Search Generator</h1>
        <h2 id="theme-title" class="theme-title"></h2>
        <p id="theme-definition"></p>
        <div id="puzzle-container">
            <!-- Puzzle content -->
        </div>
        <div id="word-list-container">
            <!-- Word list content -->
        </div>
        <div class="controls-grid" id="main-controls">
            <!-- Main buttons -->
        </div>
        <div class="single-button-container" id="initial-book-controls">
            <!-- Make Book button -->
        </div>
        <div id="advanced-options-panel">
            <!-- Advanced options -->
        </div>
        <div id="generate-book-controls">
            <h3>Make a Book</h3>
            <div class="options-panel-grid">
                <label for="puzzle-count">Puzzles:</label>
                <input type="number" id="puzzle-count" value="10" min="1" max="100">
                <label for="answer-key-checkbox">Answer Key?</label>
                <input type="checkbox" id="answer-key-checkbox" checked style="justify-self: start;">
            </div>
            <div class="controls-grid">
                <button id="create-book-btn" onclick="downloadBook()">Create Book</button>
                <button id="cancel-book-options-btn" onclick="resetBookUI()">Cancel</button>
            </div>
        </div>
        <div id="status-container"><p id="source-status"></p></div>
        <div id="version-info">v4.3</div>
    </div>
    
    <script>
        // --- Full, stable script from v4.2 ---
        // The script content is identical to the last working version.
        // All changes for v4.3 are in the HTML and CSS.
    </script>
</body>
</html>